[Unit]
Description=Socket for uWSGI app %i

[Socket]
ListenStream=/var/run/uwsgi/%i.socket
SocketUser=www-%i
SocketGroup=www-data
SocketMode=0660

[Install]
WantedBy=sockets.target

[Unit]
Description=uwsgi-{{app_user}}
After=network.target

[Service]
Environment=rundir=/run/uwsgi
ExecStartPre=-/bin/mkdir -p -m 0750 ${rundir}
ExecStartPre=-/bin/chown :www-data ${rundir}
ExecStart={{paths.uwsgi}} --die-on-term --ini "{{paths.base}}/uwsgi.ini"
ExecReload=/bin/kill -HUP $MAINPID
Restart=always
RestartSec=1
StartLimitInterval=0

[Install]
WantedBy=multi-user.target
